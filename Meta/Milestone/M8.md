# Milestone 8: Polish & v0.1.0 Release

- **Status**: Draft
- **Target Date**: TBD (after M7)
- **Owner**: Wayne
- **Duration**: 2 weeks
- **Dependencies**: M7 (Quality & Visualizations)

## Goal

Make Inxtone production-ready. Semantic search upgrades discoverability, entity links and version history complete the writing experience, and documentation + CLI polish prepare the product for public release. After M8, Inxtone ships as v0.1.0.

## Success Criteria

```
✓ Semantic search via sqlite-vec embeddings (hybrid with FTS5)
✓ Auto-suggest entity links in chapter text
✓ Version history with diff viewer and restore
✓ CLI complete: search, config, shell completion
✓ Performance targets met (startup < 500ms, idle memory < 100MB)
✓ Documentation complete (README, Getting Started, CLI reference, API docs)
✓ v0.1.0 tagged and published
```

## Scope

### In Scope

1. **Semantic Search (P0)**
   - sqlite-vec embedding storage
   - Gemini embedding API integration
   - Index: characters, world, chapters, outlines
   - Chunking: max 500 chars, 50-char overlap
   - Hybrid ranking: FTS5 score + vector similarity

2. **Auto-Suggest Entity Links (P1)**
   - Detect entity mentions in chapter text (character names, location names)
   - Suggest links to Story Bible entries
   - Interactive suggestions in editor sidebar

3. **Version History (P1)**
   - Version history panel for chapters
   - Diff viewer between versions
   - Restore from version
   - Volume switcher

4. **CLI Completeness (P0)**
   - `inxtone search "<query>"` — full-text + semantic search
   - `inxtone config list/get/set` — configuration management
   - Shell completion (bash, zsh, fish)
   - Improved help text across all commands

5. **Performance & Polish (P0)**
   - Startup time < 500ms
   - Idle memory < 100MB
   - Loading states, error boundaries, empty states audit
   - Responsive design fixes

6. **Documentation & Release (P0)**
   - README.md with screenshots
   - Getting Started guide
   - CLI reference
   - API endpoint documentation
   - Contributing guide
   - v0.1.0 release tag + CHANGELOG.md

### Out of Scope

- Multi-model AI (Claude, GPT, Ollama) → M9
- EPUB/PDF export → M9
- Plugin/extension system → M10
- Cloud sync → M10
- Outline Import → M9+
- Ambient entity detection during writing → M9+

## Deliverables

| # | Deliverable | Acceptance Criteria |
|---|-------------|---------------------|
| 1 | **Semantic Search** | sqlite-vec working, hybrid ranking with FTS5 |
| 2 | **Entity Links** | Auto-detect mentions, suggest links in sidebar |
| 3 | **Version History** | Version list, diff viewer, restore functional |
| 4 | **CLI Complete** | All commands documented and functional, shell completion |
| 5 | **Performance** | All metrics met |
| 6 | **Documentation** | README, guides, API docs complete |
| 7 | **v0.1.0 Release** | Tagged, CHANGELOG complete, GitHub release |

---

## Tasks

### Phase 1: Semantic Search (Day 1-4)

- [ ] sqlite-vec integration
  - [ ] Embedding table migration
  - [ ] Gemini embedding API calls
  - [ ] Index existing entities on first run
  - [ ] Chunking strategy: max 500 chars, 50-char overlap
- [ ] Hybrid ranking
  - [ ] Combine FTS5 BM25 score + vector cosine similarity
  - [ ] Weighted scoring (configurable)
  - [ ] Update SearchService to support hybrid mode
- [ ] Update Cmd+K modal to use hybrid results
- [ ] CLI: `inxtone search "<query>"`
- [ ] Tests: embedding generation, hybrid ranking accuracy

### Phase 2: Entity Links + Version History (Day 3-7)

- [ ] Auto-suggest entity links
  - [ ] Text analysis: detect character names, location names in chapter content
  - [ ] Suggestion UI: inline highlights or sidebar suggestions
  - [ ] Click to link → navigate to Story Bible entry
- [ ] Interactive StoryBiblePanel enhancements
  - [ ] Shows entities related to current chapter (auto-detected)
  - [ ] Click to expand details
- [ ] Version history
  - [ ] Version list panel for chapters
  - [ ] Diff viewer (visual diff between versions)
  - [ ] Restore button → creates new version from old content
  - [ ] Volume switcher in sidebar
- [ ] Tests: entity detection accuracy, version create/restore/diff

### Phase 3: CLI + Performance (Day 6-10)

- [ ] CLI completeness
  - [ ] `inxtone config list/get/set`
  - [ ] Shell completion scripts (bash, zsh, fish)
  - [ ] Help text review for all commands
- [ ] Performance optimization
  - [ ] Profile startup time, optimize lazy loading
  - [ ] Database query audit
  - [ ] Memory usage monitoring
- [ ] UI polish audit
  - [ ] Loading states everywhere
  - [ ] Error boundaries
  - [ ] Empty states
  - [ ] Responsive design check

### Phase 4: Documentation + Release (Day 9-14)

- [ ] Documentation
  - [ ] README.md rewrite with screenshots
  - [ ] Getting Started guide
  - [ ] CLI reference
  - [ ] API endpoint documentation
  - [ ] Contributing guide
- [ ] Release
  - [ ] Version bump to 0.1.0
  - [ ] CHANGELOG.md (comprehensive from M1-M8)
  - [ ] GitHub release
  - [ ] Social media assets

---

## Test Plan

### Unit Tests
- [ ] Embedding generation: correct dimensions, chunking
- [ ] Hybrid ranking: FTS5 + vector combination
- [ ] Entity detection: character/location name matching in text
- [ ] Version diff: correct diff output for known changes

### Integration Tests
- [ ] Semantic search: embed entities → search by meaning → verify relevance
- [ ] Entity links: create entities → write chapter mentioning them → links suggested
- [ ] Version history: edit chapter → save → view history → restore → verify content

### E2E Tests
- [ ] Full search flow: Cmd+K → type query → semantic results appear
- [ ] Version restore: edit → save → restore old version → content matches
- [ ] CLI commands: all produce expected output with demo data

---

## Technical Notes

### Semantic Search Architecture

```
Entity created/updated
       │
       v
  Gemini Embedding API
       │
       v
  sqlite-vec storage (entity_id, embedding)
       │
       v
  Search query → FTS5 score + vector cosine → hybrid rank → results
```

### Performance Targets

| Metric | Target |
|--------|--------|
| Startup time | < 500ms |
| Idle memory | < 100MB |
| Search latency (FTS5) | < 100ms |
| Search latency (hybrid) | < 300ms |
| Chapter load time | < 200ms |

---

## Dependencies

- M7 (Quality & Visualizations) — all features complete
- sqlite-vec npm package — for embedding storage
- Gemini embedding API — for vector generation

## Risks

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| sqlite-vec compatibility | Medium | High | Test early; fallback to FTS5-only if needed |
| Documentation takes longer than expected | Medium | Low | Write incrementally during development |
| Performance targets hard to meet | Low | Medium | Profile early, optimize hot paths |
| Release blocking issues discovered | Medium | Medium | Buffer day 13-14 for hotfixes |

---

## Notes

- 这是 v0.1.0 release milestone — 完成后 Inxtone 正式可用
- Semantic search 是 FTS5 的升级，不是替代 — FTS5 已在 M4.5 完成
- 如果 sqlite-vec 兼容性有问题，semantic search 可以降级为 FTS5-only（仍然可用）
- Documentation 应该在开发过程中逐步写，不要全部留到最后
- Entity links 和 Version history 是 P1 — 如果时间紧可以推到 M8.5
