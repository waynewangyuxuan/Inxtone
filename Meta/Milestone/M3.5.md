# Milestone 3.5: Hackathon Submission

- **Status**: Complete ✅
- **Target Date**: 2026-02-09
- **Owner**: Wayne
- **Duration**: 1 day (hackathon deadline)
- **Dependencies**: M3 (Writing Workspace)

## Goal

Prepare Inxtone for **Gemini 3 Hackathon** submission. Make the app deployable, English-ready, and demo-friendly for judges who have never seen the project before. First-run UX must be seamless: API key setup → seed data loading → explore & write.

## Success Criteria

```
✅ All AI prompts and context labels in English
✅ API Key dialog with verification on first visit
✅ Seed loader UI (English / Chinese / Empty)
✅ Functional Settings page (key management, seed management)
✅ Dockerfile ready for deployment
☐ Demo video recorded and uploaded
```

## Scope

### In Scope

1. **English AI Prompts (P0)**
   - Translate all 5 prompt templates to English
   - Translate all context builder labels to English
   - Update test assertions

2. **Per-Request API Key (P0)**
   - Client sends API key via `X-Gemini-Key` header
   - Server uses request key > env var fallback
   - `POST /api/ai/verify-key` endpoint
   - AI routes always registered (503 if no key)

3. **API Key Dialog (P0)**
   - Modal on first visit (no key in localStorage)
   - Input + masked display (last 4 chars)
   - Verify button → lightweight Gemini API call
   - Success → localStorage → close; Failure → error message
   - "Skip" link for browsing without AI
   - Accessible from Settings page

4. **Seed Loader (P0)**
   - `GET /api/seed/status` — check if DB has data
   - `POST /api/seed/load` — load English or Chinese demo
   - `POST /api/seed/clear` — clear all data
   - Welcome screen with 3 cards when DB is empty

5. **Settings Page (P1)**
   - API Key: masked display + Change + Clear
   - Seed Data: Load English / Load Chinese / Clear All

6. **Deployment (P0)**
   - Dockerfile (multi-stage build)
   - Deploy to Railway/Render/Fly.io
   - SQLite ephemeral (judges reload seed via UI)
   - BYOK model (no server-side key)

### Out of Scope (deferred to issues)

- Dashboard redesign
- Bilingual prompt mode (system language → prompt language)
- Multi-novel/project support (project_id FK)
- Novel/project selection UI

## Deliverables

| # | Deliverable | Acceptance Criteria |
|---|-------------|---------------------|
| 1 | **English AI Prompts** | All templates + context labels in English, tests pass |
| 2 | **API Key Architecture** | Per-request key via header, verify endpoint works |
| 3 | **API Key Dialog** | First-visit modal, verify flow, localStorage persistence |
| 4 | **Seed Loader** | Server endpoints + Welcome screen with 3 options |
| 5 | **Settings Page** | Key management + seed management functional |
| 6 | **Deployment** | Public URL accessible, full flow works |
| 7 | **Demo Video** | ≤3 min, English, uploaded to YouTube |

---

## Tasks

### Phase 1: English AI Prompts & Context Labels ✅

- [x] Translate `templates.ts` — all 5 templates (CONTINUE, DIALOGUE, DESCRIBE, BRAINSTORM, ASK_BIBLE)
- [x] Translate `BaseContextBuilder.ts` — section headers + character format labels
- [x] Translate `ChapterContextBuilder.ts` — all Chinese context labels
- [x] Translate `GlobalContextBuilder.ts` — same pattern
- [x] Translate `AIService.ts` — relationship labels
- [x] Update test assertions for English strings
- [x] Verify: `pnpm test` passes

### Phase 2: Per-Request API Key Architecture ✅

- [x] `GeminiProvider.ts` — `stream()` accepts optional `apiKey`, create GoogleGenAI per-call
- [x] `AIService.ts` — thread `apiKey?` through all generation methods + helpers
- [x] `services.ts` — update `IAIService` interface
- [x] `ai.ts` routes — extract `X-Gemini-Key` header, pass to service
- [x] `ai.ts` routes — add `POST /verify-key` endpoint
- [x] `index.ts` — always create AIService
- [x] `api.ts` — add key header from localStorage to all requests
- [x] `aiStream.ts` — add key header to SSE fetch

### Phase 3: API Key Dialog ✅

- [x] Create `useApiKeyStore.ts` (Zustand)
- [x] Create `ApiKeyDialog.tsx` + CSS module
- [x] Integrate in `App.tsx` — show on first visit
- [x] Verify: fresh browser → dialog → verify → close → AI works

### Phase 4: Seed Loader Endpoints ✅

- [x] Create `seedRunner.ts` — raw SQL execution (replaces service-based approach)
- [x] Create `sql-en.ts` + `sql-zh.ts` — SQL seed files as TS string exports
- [x] Create `seed.ts` routes — status / load / clear
- [x] Register in `index.ts` (pass db to deps)
- [x] Verify: API endpoints work, seeds load 6 characters + 3 chapters per language

### Phase 5: Welcome Screen & Settings ✅

- [x] Create `WelcomeScreen.tsx` + CSS module — 3 cards
- [x] Modify `Dashboard.tsx` — show WelcomeScreen when DB empty
- [x] Rewrite `Settings.tsx` — API key section + seed data section
- [x] Verify: empty DB → welcome → pick demo → dashboard shows data

### Phase 6: Deployment ✅

- [x] Create `Dockerfile` (multi-stage, node:20-slim)
- [x] Create `.dockerignore`
- [ ] Test local Docker build + run
- [ ] Deploy to Railway/Render
- [ ] Verify: public URL → full flow works

### Phase 7: Submission Materials (partial)

- [x] Update DEVPOST_WRITEUP.md
- [x] Update HACKATHON_VIDEO_SCRIPT.md
- [ ] Record demo video
- [ ] Upload to YouTube
- [ ] Submit on Devpost

---

## Execution Order

```
Phase 1 (English prompts) ──────────────────→ ─┐
Phase 2 (API key architecture) ─→ Phase 3 (UI) ├→ Phase 6 (Deploy) → Phase 7 (Submit)
Phase 4 (Seed endpoints) ───→ Phase 5 (Welcome) ┘
```

Phases 1, 2, 4 are independent — can parallelize.

---

## Technical Notes

### API Key Flow

```
Browser (localStorage)
    │
    ├─ First visit: no key → ApiKeyDialog
    │   └─ User pastes key → POST /api/ai/verify-key
    │       ├─ 200 { valid: true } → save to localStorage → close
    │       └─ 200 { valid: false } → show error
    │
    ├─ Subsequent visits: key exists → skip dialog
    │
    └─ AI requests: X-Gemini-Key header
        └─ Server: request header key > env var fallback
```

### Seed Loader Flow

```
App loads → GET /api/seed/status
    │
    ├─ { isEmpty: true } → Show WelcomeScreen
    │   ├─ "English Demo" → POST /api/seed/load { lang: "en" }
    │   ├─ "中文 Demo" → POST /api/seed/load { lang: "zh" }
    │   └─ "Start Empty" → close welcome, go to empty dashboard
    │
    └─ { isEmpty: false } → Show normal Dashboard
```

### Docker Architecture

```dockerfile
# Build stage: node:20-slim + pnpm + build all packages
# Runtime stage: node:20-slim + dist files + migrations + node_modules
# Port: 3456, serves API + static web files
# SQLite: /tmp/inxtone.db (ephemeral, reloaded via seed UI)
```

---

## Dependencies

- M3 must be complete (AI service, writing workspace, plot system)
- English seed: `packages/core/src/db/seeds/sql-en.ts` (raw SQL, 6 chars + 3 chapters with full prose)
- Chinese seed: `packages/core/src/db/seeds/sql-zh.ts` (raw SQL, 6 chars + 3 chapters with full prose)

## Risks

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Test breakage from Chinese→English strings | Medium | Medium | Grep all Chinese in tests, update in lockstep |
| `better-sqlite3` native build in Docker | Medium | High | Test Docker build early, add build-essential |
| Deadline pressure (same-day) | High | High | Prioritize P0 items, skip P1 if needed |
| SQLite ephemeral data loss in container | Low | Low | Judges reload seed via UI, acceptable for demo |

---

## Notes

- 评委不需要自备 API key 以外的任何东西
- Devpost writeup 需要提醒评委去 aistudio.google.com 获取免费 Gemini API key
- 视频脚本需要更新：只演示实际实现的功能
- Settings page 是 P1，如果时间不够可以简化
